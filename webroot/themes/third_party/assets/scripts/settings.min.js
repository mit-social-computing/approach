(function(e){if(typeof window.Assets=="undefined"){window.Assets={}}Assets.onAllFiledirsChange=function(j){var k=e(j),i=!!k.attr("checked"),l=e("input",k.parent().parent().next());l.attr({checked:i,disabled:i})};e(".assets-view").each(function(){var j=e(".assets-view-thumbs",this),i=e(".assets-view-list",this),k=e(this).parent().parent().next().hide();j.change(function(){k.hide()});i.change(function(){k.show()})});e("form#source_form").keydown(function(j){var i=(j.which)?j.which:event.keyCode;if(i==13){j.stopPropagation();e(this).find("input:last").click()}}).submit(function(i){if(e("input#source_name").val().length<1){i.preventDefault()}});var c=e();function g(){var i=c.find(":selected");e("#s3_bucket_location").val(i.attr("data-location"));e("#s3_bucket_url_prefix").val(i.attr("data-url-prefix"))}e(".refresh_buckets").live("click",function(i){i.preventDefault();var j={ACT:Assets.actions.get_s3_buckets};e("input.setting_field[data-type=s3]").each(function(){j[e(this).prop("name")]=e(this).val()});e("#s3_buckets").html('<div class="assets-loading"></div>');e.post(Assets.siteUrl,j,function(k){e("#s3_buckets").html(k);c=e("#s3_buckets > select");c.change(g);g()})});var f=e();function h(){var i=f.find(":selected");e("#gc_bucket_url_prefix").val(i.attr("data-url-prefix"))}e(".refresh_gc_buckets").live("click",function(i){i.preventDefault();var j={ACT:Assets.actions.get_gc_buckets};e("input.setting_field[data-type=gc]").each(function(){j[e(this).prop("name")]=e(this).val()});e("#gc_buckets").html('<div class="assets-loading"></div>');e.post(Assets.siteUrl,j,function(k){e("#gc_buckets").html(k);f=e("#gc_buckets > select");f.change(h);h()})});$containerSelect=e();function a(){var i=$containerSelect.find(":selected");e("#rs_container_url_prefix").val(i.attr("data-url-prefix"))}e(".refresh_containers").live("click",function(i){i.preventDefault();var j={ACT:Assets.actions.get_rs_containers};e("input.setting_field[data-type=rs], select.setting_field[data-type=rs]").each(function(){j[e(this).prop("name")]=e(this).val()});e("#rs_containers").html('<div class="assets-loading"></div>');e.post(Assets.siteUrl,j,function(k){e("#rs_containers").html(k);$containerSelect=e("#rs_containers > select");$containerSelect.change(a);a()})});e(".delete_source").click(function(){var i=e(this).attr("data-source-name");if(confirm(Assets.lang.confirm_delete_source.replace("{source}",i))){var j=e(this).attr("data-source-id");e("#source_id").val(j);e("form#delete_source").submit()}});var b=e("select#source_type");var d=b.val();e(".asset-source-settings[data-type="+d+"]").show();b.change(function(){e(".asset-source-settings").hide().filter("[data-type="+e(this).val()+"]").show()});e("input.assets-index").click(function(){var j=e(this);if(j.hasClass("disabled")){return}j.addClass("disabled");var i=e("input.indexing:checked");e("div#assets-dialog div#index-status-report").empty();e("div#assets-dialog div#index-message").empty();if(i.length>0){e.post(Assets.siteUrl,{ACT:Assets.actions.get_session_id},function(m){m=e.evalJSON(m);var n=m.session;var l=[];var k=new Assets.AjaxQueueManager(10,function(){e("input.assets-index.disabled").removeClass("disabled");e("div.progress-bar").remove();var o=[];i.each(function(){o.push(e(this).attr("id"))});var p={ACT:Assets.actions.finish_index,session:n,command:e.toJSON({command:"statistics"}),sources:o.join(",")};e.post(Assets.siteUrl,p,function(t){t=e.evalJSON(t);if(l.length>0||typeof t.files!="undefined"){e("div#assets-dialog div#index-message").html(Assets.lang.index_stale_entries_message);var r="";if(l.length>0){r+='<div class="index-data-container"><strong>'+Assets.lang.index_folders+"</strong>";for(var q=0;q<l.length;q++){r+='<div><label><input type="checkbox" checked="checked" class="delete_folder" value="'+l[q].folder_id+'" /> '+l[q].folder_name+"</label></div>"}r+="</div>"}if(typeof t.files!="undefined"){r+='<div class="index-data-container"><strong>'+Assets.lang.index_files+"</strong>";for(var s in t.files){r+='<div><label><input type="checkbox" checked="checked" class="delete_file" value="'+s+'" /> '+t.files[s]+"</label></div>"}r+="</div>"}r+='<br /><input type="button" class="submit" value="'+Assets.lang._delete+'" onclick="deleteSelectedFiles();"/>';e("#index-status-report").empty().append(r)}else{e("div#assets-dialog div#index-status-report").empty();e("div#index-message").html(Assets.lang.index_complete)}e("div#assets-dialog").show()})});i.each(function(){e(this).parent().find(".progress-bar").remove().end().append('<div class="progress-bar"><div class="progress-filler"></div></div>');var o=e(this).siblings(".progress-bar");var p={ACT:Assets.actions.start_index,source:e(this).attr("id"),session:n};k.addItem(Assets.siteUrl,p,function(s){s=e.evalJSON(s);o.attr("total",s.total).attr("current",0);for(var r=0;r<s.total;r++){p={ACT:Assets.actions.perform_index,session:n,source_type:s.source_type,source_id:s.source_id,offset:r};k.addItem(Assets.siteUrl,p,function(){var u=parseInt(o.attr("current"),10);o.attr("current",++u);var t=Math.min(Math.ceil(100/o.attr("total")*u),100)+"%";o.find(".progress-filler").stop().animate({width:t},70,"linear")})}for(var q in s.missing_folders){l.push({folder_id:q,folder_name:s.missing_folders[q]})}})});k.startQueue()})}else{j.removeClass("disabled")}})})(jQuery);function deleteSelectedFiles(){var b={};b.command="delete";b.folder_ids=[];b.file_ids=[];$("div#assets-dialog input.delete_folder:checked").each(function(){b.folder_ids.push($(this).val())});$("div#assets-dialog input.delete_file:checked").each(function(){b.file_ids.push($(this).val())});var a={ACT:Assets.actions.finish_index,command:$.toJSON(b)};$.post(Assets.siteUrl,a,function(){$("div#assets-dialog div#index-status-report").empty();$("#index-message").html(Assets.lang.index_complete)})};